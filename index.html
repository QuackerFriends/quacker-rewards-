<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quacker Friends Shop</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #fafafa;
      color: #333;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 25px;
      background: #ff8800;
      color: white;
    }
    header h1 {
      margin: 0;
      font-size: 22px;
    }
    #profileButton {
      background: white;
      color: #ff8800;
      border: none;
      border-radius: 5px;
      padding: 8px 15px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
    }
    #profileButton:hover {
      background: #ffd9b3;
    }
    #profileSection {
      position: absolute;
      right: 20px;
      top: 60px;
      width: 260px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: none;
      padding: 15px;
      z-index: 10;
    }
    #profileSection h3 {
      margin-top: 0;
      font-size: 16px;
    }
    #disconnectButton, #switchButton {
      background: #ff8800;
      border: none;
      color: white;
      padding: 6px 12px;
      margin: 5px 3px 0 0;
      border-radius: 4px;
      cursor: pointer;
    }
    #shop {
      display: flex;
      gap: 20px;
      padding: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .item {
      background: white;
      border-radius: 8px;
      padding: 15px;
      width: 200px;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .item:hover {
      transform: scale(1.05);
    }
    .item img {
      width: 100%;
      border-radius: 8px;
    }
    .buyButton {
      background: #ff8800;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 15px;
      margin-top: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .buyButton:hover {
      background: #e67300;
    }
  </style>
</head>
<body>
  <header>
    <h1>ü¶Ü Quacker Friends Shop</h1>
    <button id="profileButton">Profile</button>
  </header>

  <div id="profileSection">
    <h3>Profile</h3>
    <div id="profileContent">Connect wallet to see details...</div>
    <button id="switchButton">Switch Wallet</button>
    <button id="disconnectButton">Disconnect</button>
  </div>

  <main id="shop">
    <div class="item">
      <img src="https://via.placeholder.com/200" alt="Pumpkin Keychain">
      <h4>Pumpkin Crochet Keychain</h4>
      <p>Price: 0.001 ETH</p>
      <button class="buyButton" onclick="buyItem('Pumpkin Crochet Keychain', '0.001')">Buy</button>
    </div>
    <div class="item">
      <img src="https://via.placeholder.com/200" alt="Cat Beanie">
      <h4>Cat Beanie</h4>
      <p>Price: 0.0025 ETH</p>
      <button class="buyButton" onclick="buyItem('Cat Beanie', '0.0025')">Buy</button>
    </div>
    <div class="item">
      <img src="https://via.placeholder.com/200" alt="Pumpkin Duck Plushie">
      <h4>Pumpkin Duck Plushie</h4>
      <p>Price: 0.005 ETH</p>
      <button class="buyButton" onclick="buyItem('Pumpkin Duck Plushie', '0.005')">Buy</button>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script>
    const CONTRACT_ADDRESS = "0xa2c82bda5585c1d729e2b4f85dcc9a11ded7db4c";
    const GOOGLE_SCRIPT_URL = "YOUR_APPSCRIPT_URL_HERE"; // replace this

    let web3;
    let userAddress = null;

    document.getElementById("profileButton").addEventListener("click", async () => {
      const profile = document.getElementById("profileSection");
      profile.style.display = profile.style.display === "block" ? "none" : "block";

      if (profile.style.display === "block" && userAddress) {
        updateUI();
      } else if (profile.style.display === "block") {
        await connectWallet();
      }
    });

    async function connectWallet() {
      if (window.ethereum) {
        try {
          web3 = new Web3(window.ethereum);
          const accounts = await ethereum.request({ method: "eth_requestAccounts" });
          userAddress = accounts[0];
          await switchToBase();
          updateUI();
        } catch (err) {
          console.error("Wallet connection error:", err);
        }
      } else {
        alert("MetaMask not detected!");
      }
    }

    async function switchToBase() {
      try {
        await window.ethereum.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: "0x2105" }], // Base Mainnet
        });
      } catch (switchError) {
        if (switchError.code === 4902) {
          await window.ethereum.request({
            method: "wallet_addEthereumChain",
            params: [{
              chainId: "0x2105",
              chainName: "Base Mainnet",
              nativeCurrency: { name: "Ethereum", symbol: "ETH", decimals: 18 },
              rpcUrls: ["https://mainnet.base.org"],
              blockExplorerUrls: ["https://basescan.org"]
            }]
          });
        }
      }
    }

    function disconnectWallet() {
      userAddress = null;
      web3 = null;
      updateUI();
      document.getElementById("profileSection").style.display = "none";
    }

    async function switchWallet() {
      alert("üîÑ Please switch account from your MetaMask extension.");
    }

    if (window.ethereum) {
      ethereum.on("accountsChanged", (accounts) => {
        if (accounts.length) {
          userAddress = accounts[0];
          updateUI();
          document.getElementById("profileSection").style.display = "none";
        } else {
          disconnectWallet();
        }
      });

      ethereum.on("chainChanged", () => window.location.reload());
    }

    function updateUI() {
      const profileContent = document.getElementById("profileContent");
      if (!userAddress) {
        profileContent.innerHTML = "Connect wallet to see details...";
        return;
      }
      profileContent.innerHTML = `
        <p><strong>Wallet:</strong> ${userAddress}</p>
      `;
    }

    async function buyItem(item, price) {
      if (!web3 || !userAddress) {
        await connectWallet();
      }
      try {
        const tx = await ethereum.request({
          method: "eth_sendTransaction",
          params: [{
            from: userAddress,
            to: CONTRACT_ADDRESS,
            value: web3.utils.toHex(web3.utils.toWei(price, "ether"))
          }]
        });

        const address = prompt("Enter shipping address:");
        if (address) {
          await fetch(`${GOOGLE_SCRIPT_URL}?item=${encodeURIComponent(item)}&wallet=${userAddress}&price=${price}&address=${encodeURIComponent(address)}`);
          alert(`‚úÖ Purchase successful! TX: ${tx}`);
        }
      } catch (err) {
        console.error("Payment failed:", err);
        alert("‚ö†Ô∏è Payment or logging failed.");
      }
    }

    document.getElementById("disconnectButton").addEventListener("click", disconnectWallet);
    document.getElementById("switchButton").addEventListener("click", switchWallet);
  </script>
</body>
</html>
