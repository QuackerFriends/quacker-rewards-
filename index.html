<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Quacker Friends Shop</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #fdf6e3;
    }
    header {
      background: #ffde59;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 { margin: 0; }
    .btn {
      padding: 0.5rem 1rem;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      font-weight: bold;
    }
    #items {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .card {
      background: white;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    .card img {
      max-width: 100%;
      border-radius: 6px;
    }
    .actionBtn {
      margin-top: 0.5rem;
      background: #ffde59;
    }
    #profileSection {
      padding: 1rem;
      background: #fff3c4;
      margin: 1rem;
      border-radius: 8px;
    }
    /* Toast container */
    #toastWrap {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .toast {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: white;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      min-width: 220px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      font-size: 14px;
      animation: fadein 0.3s;
    }
    .toast.success { background: #4caf50; }
    .toast.error { background: #f44336; }
    .toast.warn { background: #ff9800; }
    .toast.info { background: #2196f3; }
    .toast .close-btn {
      margin-left: auto;
      cursor: pointer;
      font-weight: bold;
    }
    .toast .icon {
      width: 18px;
      height: 18px;
    }
    @keyframes fadein {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <header>
    <h1>🦆 Quacker Friends Shop</h1>
    <div>
      <button id="connectWallet" class="btn">Connect Wallet</button>
      <button id="profileButton" class="btn">Profile</button>
    </div>
  </header>

  <div id="items"></div>
  <div id="profileSection" style="display:none"></div>

  <!-- Toasts -->
  <div id="toastWrap"></div>

  <script>
    /***********************
     * Toasts with icons
     ***********************/
    function showToast(message, type = "info", duration = 4000) {
      const wrap = document.getElementById("toastWrap");
      const t = document.createElement("div");
      t.className = "toast " + type;
      t.innerHTML = `
        <i data-lucide="${
          type === "success" ? "check-circle" :
          type === "error"   ? "x-circle" :
          type === "warn"    ? "alert-triangle" : "info"
        }" class="icon"></i>
        <span>${message}</span>
        <span class="close-btn" onclick="this.parentElement.remove()">✕</span>`;
      wrap.appendChild(t);

      // refresh icons for new toast
      lucide.createIcons();

      if (duration > 0) setTimeout(()=> t.remove(), duration);
    }

    /***********************
     * Wallet helpers
     ***********************/
    let web3;
    let userAddress = null;

    async function connectWallet() {
      if (!window.ethereum) {
        showToast("⚠️ Install MetaMask (or compatible wallet) first", "warn");
        return;
      }
      try {
        web3 = new Web3(window.ethereum);
        const accounts = await ethereum.request({ method: "eth_requestAccounts" });
        userAddress = accounts[0];
        updateUI();
        showToast("✅ Wallet connected", "success");
      } catch (err) {
        console.error("connectWallet error", err);
        showToast("❌ Failed to connect wallet", "error");
      }
    }

    async function switchWallet() {
      if (!window.ethereum) {
        showToast("⚠️ No wallet detected", "warn");
        return;
      }
      try {
        await ethereum.request({
          method: "wallet_requestPermissions",
          params: [{ eth_accounts: {} }]
        });

        const accounts = await ethereum.request({ method: "eth_requestAccounts" });
        userAddress = accounts[0] || null;
        updateUI();
        if (userAddress) {
          showToast("🔄 Wallet switched to " + userAddress.slice(0,6) + "..." + userAddress.slice(-4), "success");
        }
      } catch (err) {
        console.error("switchWallet error", err);
        showToast("❌ Switch wallet canceled or failed", "error");
      }
    }

    function disconnectWallet() {
      userAddress = null;
      web3 = null;
      updateUI();
      showToast("❌ Disconnected", "error");
    }

    function updateUI() {
      document.getElementById("connectWallet").innerText = userAddress ? "Switch Wallet" : "Connect Wallet";
      document.getElementById("profileSection").style.display = userAddress ? "block" : "none";
    }

    /***********************
     * Demo items
     ***********************/
    const items = [
      {name:"Quacker Plush", img:"https://i.imgur.com/360yhy.png", price:"0.01"},
      {name:"Duck Keychain", img:"https://i.imgur.com/5c51p0.png", price:"0.005"},
    ];

    function renderItems() {
      const c = document.getElementById("items");
      c.innerHTML = "";
      items.forEach(it=>{
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${it.img}">
          <h3>${it.name}</h3>
          <p>${it.price} ETH</p>
          <button class="btn actionBtn">Buy</button>`;
        card.querySelector("button").addEventListener("click", ()=> {
          if (!userAddress) { showToast("⚠️ Connect wallet first", "warn"); return; }
          showToast("🛒 Buying " + it.name, "info");
        });
        c.appendChild(card);
      });
    }

    document.getElementById("connectWallet").addEventListener("click", connectWallet);
    document.getElementById("profileButton").addEventListener("click", ()=>showToast("Profile coming soon!", "info"));

    renderItems();
  </script>

  <!-- Lucide icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <script> lucide.createIcons(); </script>
</body>
</html>
