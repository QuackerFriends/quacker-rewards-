<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quacker Friends Crochet Shop</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Keep your existing styles unchanged... */
    #profile-button { /* ... */ display:none; }
    #profile-modal { /* ... */ }
    /* rest remain the same */
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ§¶ Quacker Friends Crochet Shop</h1>
    <div id="wallet-section">
      <button id="connect-button">Connect Wallet</button>
      <!-- switch/disconnect buttons -->
      <p id="wallet-address"></p>
    </div>

    <button id="profile-button" onclick="toggleProfile()">User Profile</button>

    <div id="profile-modal">
      <h3>Your Profile</h3>
      <p id="profile-wallet"></p>

      <div id="keychain-section" style="display:none;">
        <p>Youâ€™re eligible for a free Quacker Keychain!</p>
        <textarea id="shipping-address" rows="3"></textarea>
        <button onclick="submitClaim()">Claim Free Keychain</button>
      </div>

      <div id="claimed-section" style="display:none;">
        <p>âœ… You've already claimed your free keychain!</p>
      </div>

      <button onclick="toggleProfile()">Close</button>
    </div>

    <div id="shop" style="display:none;">
      <!-- your shop items (tee & tapestry) intact -->
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="wallet.js"></script>
  <script src="shop.js"></script>

  <script>
    let userAddress = '';
    let nftBalance = 0;
    let hasClaimed = false;

    async function checkWalletStatus() {
      if (!window.ethereum) return;
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const signer = provider.getSigner();

      userAddress = await signer.getAddress();
      const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);

      nftBalance = (await contract.balanceOf(userAddress)).toNumber();
      try {
        hasClaimed = await contract.hasClaimed(userAddress);
      } catch {
        hasClaimed = false;
      }

      document.getElementById('profile-button').style.display = 'inline-block';
      document.getElementById('wallet-address').textContent = 'Connected: ' + userAddress;
      document.getElementById('shop').style.display = 'block';
    }

    function toggleProfile() {
      const modal = document.getElementById('profile-modal');
      const keychain = document.getElementById('keychain-section');
      const claimed = document.getElementById('claimed-section');
      const walletText = document.getElementById('profile-wallet');

      modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
      walletText.textContent = `Wallet: ${userAddress} | NFTs: ${nftBalance}`;

      keychain.style.display = 'none';
      claimed.style.display = 'none';

      if (nftBalance > 0) {
        if (hasClaimed) {
          claimed.style.display = 'block';
        } else {
          keychain.style.display = 'block';
        }
      }
      // Non-holders (nftBalance === 0): no keychain or claimed sections shown
    }

    document.getElementById('connect-button').addEventListener('click', async () => {
      await window.ethereum.request({ method: 'eth_requestAccounts' });
      await checkWalletStatus();
    });

    window.addEventListener('load', async () => {
      if (window.ethereum && (await window.ethereum.request({ method: 'eth_accounts' })).length > 0) {
        await checkWalletStatus();
      }
    });
  </script>
</body>
</html>
