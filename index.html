<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Shop</title>
<style>
  :root {
    --brand-orange: #ff6600;
  }
  body {
    font-family: Arial, sans-serif;
    background: #fafafa;
    color: #333;
  }
  .product-card {
    background: white;
    border-radius: 16px;
    padding: 12px;
    margin: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    width: 240px;
    display: inline-block;
    vertical-align: top;
  }
  .product-card img {
    width: 100%;
    border-radius: 12px;
  }
  .product-card label {
    display: block;
    margin-top: 6px;
    font-weight: 600;
  }
  select {
    width: 100%;
    padding: 6px;
    border-radius: 8px;
    border: 1px solid #ccc;
    margin-bottom: 8px;
  }
  button.add-btn {
    background: var(--brand-orange);
    color: white;
    border: none;
    border-radius: 999px;
    padding: 8px 16px;
    font-weight: 600;
    cursor: pointer;
    width: 100%;
  }
  button.add-btn:hover {
    background: #e65c00;
  }

  /* Carousel styling */
  .carousel {
    position: relative;
    overflow: hidden;
    border-radius: 12px;
    background: #f6f6f6;
  }
  .carousel img {
    width: 100%;
    height: 220px;
    object-fit: contain;
    display: none;
    transition: opacity .25s ease;
  }
  .carousel img.active {
    display: block;
  }
  .carousel button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255,255,255,0.85);
    border: none;
    border-radius: 999px;
    width: 34px;
    height: 34px;
    cursor: pointer;
    font-size: 18px;
    color: #333;
  }
  .carousel .prev-btn { left: 8px; }
  .carousel .next-btn { right: 8px; }
  .carousel button:hover {
    background: var(--brand-orange);
    color: white;
  }
</style>
</head>
<body>

<div id="shop"></div>

<script>
const PRODUCTS = {
  tapestry: [
    {
      id: "forest_tapestry",
      title: "Forest Tapestry",
      price: 0.05,
      images: [
        "https://files.catbox.moe/3lplph.png",
        "https://files.catbox.moe/n8lx8c.png"
      ]
    }
  ],
  keychains: [
    {
      id: "quackheads_keychain",
      title: "Quackheads Keychain",
      price: 0.015,
      sizes: ["Green Quackhead", "Pink Quackhead", "Mustard Quackhead"],
      colors: ["None", "Gold", "Silver"],
      images: ["https://files.catbox.moe/gnm9n0.png"]
    }
  ]
};

const cart = [];

function showToast(msg,type="success"){
  console.log(msg);
}

function updateCartUI(){
  console.log("Cart:",cart);
}

function addToCart(prodId){
  let product = null;
  for (const cat of Object.keys(PRODUCTS)) {
    product = (PRODUCTS[cat]||[]).find(p=>p.id===prodId);
    if (product) {
      const thumb = product.images && Array.isArray(product.images) ? product.images[0] : product.images;
      const colorEl = document.getElementById(`color_${prodId}`);
      const sizeEl = document.getElementById(`size_${prodId}`);
      const color = colorEl ? colorEl.value : "";
      const size = sizeEl ? sizeEl.value : "N/A";
      cart.push({ id: product.id, title: product.title, price: product.price, color, size, q:1, thumb });
      updateCartUI();
      showToast(`${product.title} added to cart`,"success");
      return;
    }
  }
  showToast("Product not found","error");
}

function showCategory(cat){
  const el = document.getElementById("shop");
  el.innerHTML = "";
  const items = PRODUCTS[cat] || [];
  items.forEach(p=>{
    const sizeId = `size_${p.id}`;
    const colorId = `color_${p.id}`;
    
    let labelText = "Size";
    if (p.id === "quackheads_keychain") labelText = "Top Accessory";

    const sizeSelectHtml = (p.sizes && p.sizes.length) ? `
      <label>${labelText}</label>
      <select id="${sizeId}">
        ${p.sizes.map(s => `<option value="${s}">${s}</option>`).join('')}
      </select>
    ` : '';

    const colorSelectHtml = (p.colors && p.colors.length) ? `
      <label>Color</label>
      <select id="${colorId}">
        ${p.colors.map(c => `<option value="${c}">${c}</option>`).join('')}
      </select>
    ` : '';

    // Carousel setup
    let imgHtml = '';
    if (Array.isArray(p.images) && p.images.length > 1) {
      imgHtml = `
        <div class="carousel" id="carousel_${p.id}">
          ${p.images.map((img,i)=>`<img src="${img}" class="${i===0?'active':''}">`).join('')}
          <button class="prev-btn">‹</button>
          <button class="next-btn">›</button>
        </div>
      `;
    } else {
      imgHtml = `<img src="${p.images[0]}" alt="${p.title}">`;
    }

    el.innerHTML += `
      <div class="product-card">
        ${imgHtml}
        <h3>${p.title}</h3>
        <p>${p.price} ETH</p>
        ${sizeSelectHtml}
        ${colorSelectHtml}
        <button class="add-btn" onclick="addToCart('${p.id}')">Add to Cart</button>
      </div>
    `;

    // After render, setup carousel if exists
    if (Array.isArray(p.images) && p.images.length > 1) {
      setupCarousel(p.id);
    }
  });
}

function setupCarousel(id) {
  const carousel = document.getElementById(`carousel_${id}`);
  const imgs = Array.from(carousel.querySelectorAll('img'));
  let index = 0;
  const nextBtn = carousel.querySelector('.next-btn');
  const prevBtn = carousel.querySelector('.prev-btn');

  const setIndex = (newIdx) => {
    imgs[index].classList.remove('active');
    index = newIdx;
    imgs[index].classList.add('active');
  };

  nextBtn.addEventListener('click', ()=> setIndex((index+1)%imgs.length));
  prevBtn.addEventListener('click', ()=> setIndex((index-1+imgs.length)%imgs.length));

  // Swipe
  let startX = null;
  carousel.addEventListener('touchstart', (ev)=> startX = ev.touches[0].clientX);
  carousel.addEventListener('touchend', (ev)=> {
    const diff = ev.changedTouches[0].clientX - startX;
    if (diff > 30) setIndex((index-1+imgs.length)%imgs.length);
    else if (diff < -30) setIndex((index+1)%imgs.length);
    startX = null;
  });

  // Auto-slide every 4s
  setInterval(()=> setIndex((index+1)%imgs.length), 4000);
}

showCategory('tapestry');
</script>
</body>
</html>
